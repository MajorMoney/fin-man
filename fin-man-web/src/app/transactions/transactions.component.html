<div class="view">
  <h2>Expense Tracking & Categorization</h2>
  <p class="subtitle">
    View, categorize, and manage all your financial transactions. Filter by
    category, date, or amount for better insights.
  </p>

  <form [formGroup]="filtersForm" class="filters-form">
    <!-- Search bar and actions -->
    <div class="top-bar">
      <input
        type="text"
        placeholder="ðŸ” Search transactions (merchant, category, tags)"
        formControlName="searchQuery"
        class="search-input"
      />

      <div class="actions">
        <button type="button" class="clear-btn" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
      <button class="add-transaction-btn" (click)="openAddModal()">
        <span class="icon">+</span>
        Add New Transaction
      </button>
    </div>

    <!-- Filters -->
    <div class="filter-box">
      <h4>Filter Transactions</h4>

      <div class="filters">
        <div class="filter-field">
          <label for="category">Category</label>
          <select id="category" formControlName="category" class="filter-input">
            <option *ngFor="let cat of categories" [value]="cat">
              {{ cat }}
            </option>
          </select>
        </div>

        <div class="filter-field">
          <label for="fromDate">From Date</label>
          <input
            id="fromDate"
            type="date"
            formControlName="fromDate"
            class="filter-input"
            [class.invalid]="isDateRangeInvalid"
          />
        </div>

        <div class="filter-field">
          <label for="toDate">To Date</label>
          <input
            id="toDate"
            type="date"
            formControlName="toDate"
            class="filter-input"
            [class.invalid]="isDateRangeInvalid"
          />
          <span class="error-message" *ngIf="isDateRangeInvalid">
            'To Date' must be after 'From Date'
          </span>
        </div>

        <div class="filter-field">
          <label for="minAmount">Min Amount</label>
          <input
            id="minAmount"
            type="number"
            formControlName="minAmount"
            class="filter-input"
            placeholder="0.00"
            min="0"
            step="0.01"
          />
          <span
            class="error-message"
            *ngIf="
              filtersForm.get('minAmount')?.hasError('min') &&
              filtersForm.get('minAmount')?.touched
            "
          >
            Amount must be positive
          </span>
        </div>

        <div class="filter-field">
          <label for="maxAmount">Max Amount</label>
          <input
            id="maxAmount"
            type="number"
            formControlName="maxAmount"
            class="filter-input"
            placeholder="0.00"
            min="0"
            step="0.01"
          />
          <span
            class="error-message"
            *ngIf="
              filtersForm.get('maxAmount')?.hasError('min') &&
              filtersForm.get('maxAmount')?.touched
            "
          >
            Amount must be positive
          </span>
        </div>
        <div class="filter-field">
          <label for="type">Type</label>
          <select id="type" formControlName="type" class="filter-input">
            <option value="All">All</option>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
          </select>
        </div>

        <div class="filter-field">
          <label for="account">Account</label>
          <select id="account" formControlName="account" class="filter-input">
            <option *ngFor="let acc of accounts" [value]="acc">
              {{ acc }}
            </option>
          </select>
        </div>

        <div class="filter-field">
          <label for="recurring">Recurring</label>
          <select
            id="recurring"
            formControlName="recurring"
            class="filter-input"
          >
            <option value="All">All</option>
            <option [value]="true">Yes</option>
            <option [value]="false">No</option>
          </select>
        </div>
      </div>
    </div>
  </form>

  <!-- Pass filters to child component -->
  <app-transactions-list [filters$]="filters$"></app-transactions-list>

  <app-transactions-modal
    [isOpen]="isCreateModalOpen"
    [mode]="'create'"
    (closeModal)="closeEditModal()"
  >
  </app-transactions-modal>
</div>
